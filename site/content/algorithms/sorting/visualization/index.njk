---
layout: page
title: Visualizing sorting algorithms
# templateClass: tmpl-post
# eleventyNavigation:
#   key: About
#   order: 3
tags:
  - pages
  - code
hasVue: true
algorithms:
  -
    name: Improved bubble sort
    file: ./_improved-bubble-sort-generator.js
  -
    name: Improved bubble sort 2
    file: ./_improved-bubble-sort-generator.js
  -
    name: Improved bubble sort 3
    file: ./_improved-bubble-sort-generator.js
  -
    name: Improved bubble sort 4
    file: ./_improved-bubble-sort-generator.js
sets:
  - 
    name: Random
    generator: random
  - 
    name: Nearly sorted
    generator: nearlySorted
  - 
    name: Reversed
    generator: reversed
  - 
    name: Many equal
    generator: random
---

<h1>{{ title }}</h1>

<div id="app"></div>

{% raw %}
<script type="text/x-template" id="app-template">
<div>
  <div>
    <div v-for="(algorithm, i) in algorithms" class="columns is-multiline">
      <div class="column is-12">
        <h3>{{ algorithm.name }}</h3>
      </div>
      <div v-for="(set, j) in sets" class="column">
        <h4>{{ set.name }}</h4>
        <div v-bind:ref="`canvas-${i}-${j}`"></div>
      </div>
    </div>
  </div>
</div>
</script>
{% endraw %}

<script>

{% include './_visualization.js' %};

const algorithms = [];
let fn;
{% for algorithm in algorithms %}
  fn = {% include algorithm.file %};
  algorithms.push({
    name: '{{ algorithm.name }}',
    fn,
  });
{% endfor %}

const sets = []
{% for set in sets %}
  sets.push({
    name: '{{ set.name }}',
    generator: '{{ set.generator }}',
  });
{% endfor %}

function render({ compare, swap, set, chart, id }, value, done, repaint) {
  if (repaint) {
    chart.repaint(set);
    return;
  }
  const { last } = compare;
  chart.draw(last[0], set[last[0]], last[1], set[last[1]], last[2]);
  this.log(id, { compare, swap});
}

const log = () => {};
const visualizations = new Visualizations({ render, log });

const fps = false;
const max = 100;

function createVisualisations({ targets, algorithms, sets }) {
  sets.forEach((setDef, i) => {
    const set = getSet[setDef.generator]();
    algorithms.forEach((algorithm, j) => {
      visualizations.add({
        id: `${j}-${i}`,
        generatorFunction: algorithms[j].fn,
        set: set.slice(),
        chart: {
          $el: targets[j][i],
          n: set.length,
          max,
          height: 100,
          width: 300,
        },
      });
    });
  });

  visualizations.renderAll(true);
  iterate();
}

const getSet = {
  sorted() {
    const set = [];
    for (let i = 1; i <= max; ++i) {
      set.push(i);
    }
    return set;
  },
  random() {
    const set = [];
    for (let i = 1; i <= max; ++i) {
      set.push(i);
    }
    return shuffle(set);
  },
  nearlySorted() {
    const set = this.sorted();
    const first = set.shift();
    set.push(first);
    return set;
  },
  reversed() {
    return this.sorted().reverse();
  },
};

function iterate() {
  if (visualizations.allDone) return;
  visualizations.step();
  if (visualizations.allDone) {
    setTimeout(() => {
      visualizations.renderAll(true);
    }, fps === false ? 0 : 1000 / fps);
  };
  setTimeout(iterate, fps === false ? 0 : 1000 / fps);
}

vueApp = {
  el: '#app',
  template: '#app-template',
  data() {
    return {
      algorithms: algorithms,
      title: 'My title',
      message: 'loaded',
      compares: {},
      swaps: {},
    };
  },
  methods: {
    createTargets() {
      const targets = [];
      for (let i = 0; i < algorithms.length; ++i) {
        targets.push([]);
        for (let j = 0; j < sets.length; ++j) {
          targets[i].push(this.$refs[`canvas-${i}-${j}`][0]);
        }
      }
      return targets;
    }, // createTargets()

    log(id, data) {
      this.compares[id] = data.compare.count;
      this.swaps[id] = data.swap.count;
    }, // log()
  },
  mounted() {
    const targets = this.createTargets();
    const log = (id, data) => {
      this.log(id, data);
    };
    createVisualisations({ targets, algorithms, sets, log });
  }, // mounted()
}
</script>
