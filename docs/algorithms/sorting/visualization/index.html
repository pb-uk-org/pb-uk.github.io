<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizing sorting algorithms</title>
    <meta name="description" content="Paul&#39;s home page miscellany.">

    <link rel="stylesheet" href="/assets/css/prism/prism-solarizedlight.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="PB UK">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="PB UK">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/buefy/dist/buefy.min.css">
    <!-- link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9/css/bulma.css" -->



    <link rel="stylesheet" href="/assets/css/index.css">

  </head>
  <body>
    
    

<nav role="navigation" aria-label="main navigation" class="navbar is-primary">
  <div class="container">
    <div class="navbar-brand">
      <a class="navbar-item" href="/">PB UK</a>
      <a class="navbar-item" href="/articles/">Articles</a>
      <a class="navbar-item" href="/blog/">Blog</a>
      <a class="navbar-item" href="/tags/">Tags</a>
      <a class="navbar-item" href="/about/">About</a>

    </div>
  </div>
</nav>


    <section class="section py-0">
      <div class="container">
        
<nav class="breadcrumb my-3 is-size-7" aria-label="breadcrumbs">
  <ul>

  
    
      <li>In <a class="px-1" href="/algorithms/">algorithms</a></li>
    
  

  
    
      <li><a class="px-1" href="/algorithms/sorting/">sorting</a></li>
    
  

  
    
  

  </ul>
</nav>

<main class="content">
<h1 id="visualizing-sorting-algorithms">Visualizing sorting algorithms <a class="direct-link" href="#visualizing-sorting-algorithms">#</a></h1>
<p>This is where my app goes.</p>
<div id="app">
<div>{{ message }}</div>
</div>
<p><canvas id="canvas-01" width="200" height="100"></canvas></p>
<script>

function render({ compare, swap, set, chart }, value, done, repaint) {
  if (repaint) {
    chart.repaint(set);
    return;
  }
  console.log(set, value, done, repaint);
  const { last } = swap;
  chart.draw(last[0], set[last[0]], last[1], set[last[1]], last[2]);
}



class Chart {
  constructor({ el, n, max }) {
    const $el = document.querySelector(el);
    this.n = n;
    this.max = max;
    this.ctx = $el.getContext('2d');
    this.height = $el.height;
    this.width = $el.width; 
 
    this.xScale = Math.floor(this.width / n);
    this.yScale = this.height / max;
    this.last = false;
  }

  draw(aIndex, aValue, bIndex, bValue, swap) {
    const { xScale, yScale, height } = this;

    if (this.last) {
      const [ai, av, bi, bv, sw] = this.last;
      if (sw > 0) {
        // They were swapped so paint out the old positions.
        this.ctx.fillStyle = 'white';
        this.ctx.fillRect(ai * xScale, height - av * yScale, xScale, height);
        this.ctx.fillRect(bi * xScale, height - bv * yScale, xScale, height);
        // Paint the new positions in in grey.
        this.ctx.fillStyle = 'grey';
        this.ctx.fillRect(ai * xScale, height - bv * yScale, xScale, height);
        this.ctx.fillRect(bi * xScale, height - av * yScale, xScale, height);
      } else {
        // They were not swapped so just repaint in grey.
        this.ctx.fillStyle = 'grey';
        this.ctx.fillRect(ai * xScale, height - av * yScale, xScale, height);
        this.ctx.fillRect(bi * xScale, height - bv * yScale, xScale, height);
      }
    }

    if (swap > 0) {
      // They will be swapped so repaint in red.
      this.ctx.fillStyle = 'red';
      this.ctx.fillRect(aIndex * xScale, height - aValue * yScale, xScale, height);
      this.ctx.fillRect(bIndex * xScale, height - bValue * yScale, xScale, height);
    } else {
      // They are not going to be swapped so repaint in green.
      this.ctx.fillStyle = 'green';
      this.ctx.fillRect(aIndex * xScale, height - aValue * yScale, xScale, height);
      this.ctx.fillRect(bIndex * xScale, height - bValue * yScale, xScale, height);
    }

    // Remember what we did for next time.
    this.last = [ aIndex, aValue, bIndex, bValue, swap ];
  }

  repaint(set) {
    console.log('repainting');
    const { xScale, yScale, height, width } = this;

    // Paint out everything.
    this.ctx.fillStyle = 'white';
    this.ctx.fillRect(0, 0, width, height);

    this.ctx.fillStyle = 'grey';
    set.forEach((value, i) => {
      // Paint the new positions in in grey.
      this.ctx.fillRect(i * xScale, height - value * yScale, xScale, height);
    });
  }
}

class Visualizations {
  constructor({ render }) {
    this.allDone = false;
    this.visualizations = [];
    if (render) this.render = render;
  }

  add(options) {
    this.visualizations.push(new Visualization(options));
  }

  renderAll(repaint) {
    this.visualizations.forEach(vis => {
      this.render(vis, vis.set, vis.isDone, repaint);
    });
  }

  render({ compare, swap, set }, value, done, repaint) {
    console.log(done || false, value || set, compare.last, compare.count, swap.count);
  }

  step() {
    if (this.allDone) return;
    let allDone = true;
    this.visualizations.forEach(vis => {
      if (vis.isDone) return;
      const { done, value } = vis.next();
      vis.isDone = done;
      this.render(vis, value, done);
      allDone &= done;
    });
    this.allDone = allDone;
  }
}

class Visualization {
  constructor({
    generatorFunction,
    render,
    set,
    chart,
  }) {
    this.compare = new Compare();
    this.swap = new Swap();
    this.render = render;
    this.set = set;
    this.chart = new Chart(chart);

    // The visualisation is a generator function.
    this.generator = generatorFunction(set, {
      compare: this.compare.compare,
      swap: this.swap.swap,
    });

    this.algorithm = 'Improved bubble sort';
    this.initial = 'Reversed';
  }

  next() {
    return this.generator.next();
  }
}

class Compare {
  constructor() {
    this.count = 0;
    this.last = [null, null, null];

    function compare(set, a, b) {
      ++this.count;
      const result = set[a] > set[b] ? 1 : (set[a] < set[b] ? -1 : 0);
      this.last = [a, b, result];
      return result;
    }
    this.compare = compare.bind(this);
  }
}

class Swap {
  constructor() {
    this.count = 0;
    this.last = [null, null];

    function swap(set, a, b) {
      ++this.count;
      this.last = [a, b];
      const temp = set[a];
      set[a] = set[b];
      set[b] = temp;
    }
    this.swap = swap.bind(this);
  }
}
;

let fn =
function* improvedBubbleSortGenerator(set, { compare, swap }) {
  let n = set.length;
  for (let i = 0; i < n - 1; ++i) {
    for (let j = 0; j < n - i - 1; ++j) {
      if (compare(set, j, j + 1) > 0) {
        yield set;
        swap(set, j, j + 1);
      } else {
        yield set;
      }
    }
  }
  return set;
}

/*
function* improvedBubbleSortGenerator(set, { compare, swap }) {
  let n = set.length;
  do {
    let newN = 0;
    for (let i = 1; i < n; ++i) {
      // Swap if set[i-1] > set[i].
      if (compare(set, i - 1, i)) {
        yield set;
        // Swap if set[i-1] > set[i].
        swap(set, i - 1, i);
        newN = i;
      } else {
        yield set;
      }
    }
    n = newN;
  } while (n > 1);
  // The set is sorted.
  return set;
}
*/
;

const visualizations = new Visualizations({ render });

const set = [5, 4, 3, 2, 1];

visualizations.add({
  generatorFunction: fn,
  set,
  chart: {
    el: '#canvas-01',
    n: set.length,
    max: 5,
  },
});

function iterate() {
  if (visualizations.allDone) return;
  visualizations.step();
  if (visualizations.allDone) {
    setTimeout(() => {
      visualizations.renderAll(true);
    }, 100);
  };
  setTimeout(iterate, 100);
}

visualizations.renderAll(true);
iterate();

</script>
<p>s</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">improvedBubbleSortGenerator</span><span class="token punctuation">(</span><span class="token parameter">set<span class="token punctuation">,</span> <span class="token punctuation">{</span> compare<span class="token punctuation">,</span> swap <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">let</span> n <span class="token operator">=</span> set<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compare</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> j<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">yield</span> set<span class="token punctuation">;</span><br>        <span class="token function">swap</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> j<span class="token punctuation">,</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        <span class="token keyword">yield</span> set<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> set<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">/*<br>function* improvedBubbleSortGenerator(set, { compare, swap }) {<br>  let n = set.length;<br>  do {<br>    let newN = 0;<br>    for (let i = 1; i &lt; n; ++i) {<br>      // Swap if set[i-1] > set[i].<br>      if (compare(set, i - 1, i)) {<br>        yield set;<br>        // Swap if set[i-1] > set[i].<br>        swap(set, i - 1, i);<br>        newN = i;<br>      } else {<br>        yield set;<br>      }<br>    }<br>    n = newN;<br>  } while (n > 1);<br>  // The set is sorted.<br>  return set;<br>}<br>*/</span><br></code></pre>

</main>
<hr>
<div class="columns pb-5">
  <div class="column is-size-7 py-0">Previous: <a href="/algorithms/number-theory/">Number theory</a>
  </div>
  <div class="column has-text-right is-size-7 py-0">
  </div>
</div>

      </div>
    </section>

    <footer
      class="footer has-text-centered is-size-7 py-1"
      ><a href="/about/#copyright">Copyright © 2020 PBUK</a></footer>

    <!-- Current page: /algorithms/sorting/visualization/ -->
  </body>
</html>
